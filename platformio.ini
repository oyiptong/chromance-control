[platformio]
default_envs = diagnostic

[env:diagnostic]
platform = espressif32
board = featheresp32
framework = arduino
monitor_speed = 115200

lib_deps =
  adafruit/Adafruit DotStar @ ^1.2.0

; OTA-capable partition layout (two-slot app + OTA data + SPIFFS).
board_build.partitions = min_spiffs.csv

; Prefer build-time secrets from environment variables:
; WIFI_SSID='...' WIFI_PASSWORD='...' pio run -e diagnostic
extra_scripts =
  pre:scripts/wifi_from_env.py

build_src_filter =
  -<*>
  +<main_diagnostic.cpp>
  +<core/**>
  +<platform/**>
  -<platform/led/**>

[env:runtime]
platform = espressif32
board = featheresp32
framework = arduino
monitor_speed = 115200

lib_deps =
  adafruit/Adafruit DotStar @ ^1.2.0

board_build.partitions = min_spiffs.csv

extra_scripts =
  pre:scripts/wifi_from_env.py
  pre:scripts/generate_mapping_headers.py

build_flags =
  -D CHROMANCE_BENCH_MODE=0

build_src_filter =
  -<*>
  +<main_runtime.cpp>
  +<core/**>
  +<platform/**>

[env:runtime_bench]
extends = env:runtime
build_flags =
  -D CHROMANCE_BENCH_MODE=1

[env:native]
platform = native
test_framework = unity
test_build_src = true

build_src_filter =
  -<*>
  +<core/**>
